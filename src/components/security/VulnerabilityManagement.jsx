import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Shield, 
  AlertTriangle, 
  AlertCircle,
  CheckCircle,
  XCircle,
  Clock,
  Eye,
  EyeOff,
  Search,
  Filter,
  Download,
  Upload,
  RefreshCw,
  Settings,
  Bell,
  BellRing,
  User,
  Users,
  Database,
  Server,
  Network,
  Globe,
  Lock,
  Unlock,
  Key,
  Fingerprint,
  Smartphone,
  Monitor,
  HardDrive,
  Wifi,
  WifiOff,
  Mail,
  Phone,
  MessageSquare,
  FileText,
  File,
  Folder,
  FolderOpen,
  Archive,
  Trash2,
  Edit,
  Copy,
  Share,
  Link,
  ExternalLink,
  Plus,
  Minus,
  X,
  Check,
  Info,
  Warning,
  Zap,
  Target,
  Crosshair,
  Radar,
  Scan,
  ScanLine,
  Activity,
  BarChart3,
  PieChart,
  TrendingUp,
  TrendingDown,
  Calendar,
  MapPin,
  Flag,
  Tag,
  Bookmark,
  Star,
  Heart,
  ThumbsUp,
  ThumbsDown,
  MessageCircle,
  Send,
  Paperclip,
  Image,
  Video,
  Mic,
  Camera,
  Code,
  Terminal,
  GitBranch,
  GitCommit,
  GitMerge,
  Layers,
  Box,
  Package,
  Truck,
  Plane,
  Car,
  Bike,
  Bus,
  Train,
  Ship,
  Rocket,
  Satellite,
  Radio,
  Tv,
  Speaker,
  Headphones,
  Volume2,
  VolumeX,
  Play,
  Pause,
  Stop,
  SkipBack,
  SkipForward,
  Repeat,
  Shuffle,
  Music,
  Disc,
  Cassette,
  Bug,
  Wrench,
  Hammer,
  Screwdriver
} from 'lucide-react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card';
import { Button } from '../ui/button';
import { Input } from '../ui/input';
import { Badge } from '../ui/badge';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../ui/select';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';
import { ScrollArea } from '../ui/scroll-area';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '../ui/dialog';
import { Alert, AlertDescription } from '../ui/alert';
import { Separator } from '../ui/separator';
import { Label } from '../ui/label';
import { Switch } from '../ui/switch';
import { Progress } from '../ui/progress';
import { Textarea } from '../ui/textarea';
import { Checkbox } from '../ui/checkbox';
import { RadioGroup, RadioGroupItem } from '../ui/radio-group';
import { 
  LineChart, 
  Line, 
  XAxis, 
  YAxis, 
  CartesianGrid, 
  Tooltip, 
  Legend, 
  ResponsiveContainer,
  AreaChart,
  Area,
  BarChart,
  Bar,
  PieChart as RechartsPieChart,
  Cell,
  RadialBarChart,
  RadialBar
} from 'recharts';

// Vulnerability Severity Levels
const SEVERITY_LEVELS = {
  CRITICAL: { name: 'Critical', color: 'red', score: 9.0, priority: 4, sla: 24 },
  HIGH: { name: 'High', color: 'orange', score: 7.0, priority: 3, sla: 72 },
  MEDIUM: { name: 'Medium', color: 'yellow', score: 4.0, priority: 2, sla: 168 },
  LOW: { name: 'Low', color: 'green', score: 2.0, priority: 1, sla: 720 },
  INFO: { name: 'Informational', color: 'blue', score: 0.0, priority: 0, sla: null }
};

// Vulnerability Categories
const VULNERABILITY_CATEGORIES = {
  INJECTION: {
    name: 'Injection Flaws',
    description: 'SQL, NoSQL, OS, and LDAP injection',
    icon: Database,
    color: 'red'
  },
  AUTHENTICATION: {
    name: 'Broken Authentication',
    description: 'Authentication and session management flaws',
    icon: Lock,
    color: 'orange'
  },
  EXPOSURE: {
    name: 'Sensitive Data Exposure',
    description: 'Inadequate protection of sensitive data',
    icon: Eye,
    color: 'yellow'
  },
  XXE: {
    name: 'XML External Entities',
    description: 'XML processors with external entity references',
    icon: Code,
    color: 'purple'
  },
  ACCESS_CONTROL: {
    name: 'Broken Access Control',
    description: 'Restrictions not properly enforced',
    icon: Shield,
    color: 'red'
  },
  SECURITY_CONFIG: {
    name: 'Security Misconfiguration',
    description: 'Insecure default configurations',
    icon: Settings,
    color: 'orange'
  },
  XSS: {
    name: 'Cross-Site Scripting',
    description: 'XSS flaws in web applications',
    icon: Globe,
    color: 'yellow'
  },
  DESERIALIZATION: {
    name: 'Insecure Deserialization',
    description: 'Flaws in deserialization processes',
    icon: Package,
    color: 'purple'
  },
  COMPONENTS: {
    name: 'Vulnerable Components',
    description: 'Components with known vulnerabilities',
    icon: Box,
    color: 'orange'
  },
  LOGGING: {
    name: 'Insufficient Logging',
    description: 'Inadequate logging and monitoring',
    icon: Activity,
    color: 'blue'
  }
};

// Scan Types
const SCAN_TYPES = {
  NETWORK: { name: 'Network Scan', icon: Network, description: 'Network infrastructure scanning' },
  WEB_APP: { name: 'Web Application', icon: Globe, description: 'Web application security testing' },
  DATABASE: { name: 'Database', icon: Database, description: 'Database security assessment' },
  INFRASTRUCTURE: { name: 'Infrastructure', icon: Server, description: 'Infrastructure vulnerability scan' },
  COMPLIANCE: { name: 'Compliance', icon: CheckCircle, description: 'Compliance and policy checks' },
  PENETRATION: { name: 'Penetration Test', icon: Target, description: 'Manual penetration testing' }
};

// Remediation Status
const REMEDIATION_STATUS = {
  OPEN: { name: 'Open', color: 'red', icon: AlertCircle },
  IN_PROGRESS: { name: 'In Progress', color: 'yellow', icon: Clock },
  TESTING: { name: 'Testing', color: 'blue', icon: Search },
  RESOLVED: { name: 'Resolved', color: 'green', icon: CheckCircle },
  ACCEPTED: { name: 'Risk Accepted', color: 'gray', icon: Flag },
  FALSE_POSITIVE: { name: 'False Positive', color: 'purple', icon: XCircle }
};

// Sample vulnerabilities
const vulnerabilities = [
  {
    id: 'VULN-2024-001',
    title: 'SQL Injection in User Authentication',
    description: 'SQL injection vulnerability found in the user login endpoint allowing potential data extraction.',
    category: 'INJECTION',
    severity: 'CRITICAL',
    cvssScore: 9.8,
    cveId: 'CVE-2024-0001',
    discoveredDate: new Date('2024-01-15T10:30:00Z'),
    lastSeen: new Date('2024-01-15T14:20:00Z'),
    affectedAssets: ['web-app-01.company.com', 'api.company.com'],
    affectedComponents: ['Authentication Service', 'User Management API'],
    scanType: 'WEB_APP',
    scanner: 'OWASP ZAP',
    status: 'OPEN',
    assignedTo: 'security.team@company.com',
    remediation: {
      effort: 'Medium',
      timeline: '2-3 days',
      priority: 'Immediate',
      steps: [
        'Implement parameterized queries',
        'Add input validation',
        'Update authentication logic',
        'Perform security testing'
      ]
    },
    evidence: {
      request: 'POST /api/login',
      payload: "username=admin' OR '1'='1--&password=test",
      response: 'Database error revealing table structure'
    },
    riskScore: 95,
    exploitability: 'High',
    impact: 'Complete system compromise',
    tags: ['sql-injection', 'authentication', 'critical', 'owasp-top10'],
    slaDeadline: new Date('2024-01-16T10:30:00Z'),
    references: [
      'https://owasp.org/www-project-top-ten/2017/A1_2017-Injection',
      'https://cwe.mitre.org/data/definitions/89.html'
    ]
  },
  {
    id: 'VULN-2024-002',
    title: 'Outdated Apache HTTP Server',
    description: 'Apache HTTP Server version 2.4.41 contains multiple known vulnerabilities.',
    category: 'COMPONENTS',
    severity: 'HIGH',
    cvssScore: 7.5,
    cveId: 'CVE-2023-25690',
    discoveredDate: new Date('2024-01-14T09:15:00Z'),
    lastSeen: new Date('2024-01-15T12:00:00Z'),
    affectedAssets: ['web-server-01.company.com', 'web-server-02.company.com'],
    affectedComponents: ['Apache HTTP Server 2.4.41'],
    scanType: 'INFRASTRUCTURE',
    scanner: 'Nessus',
    status: 'IN_PROGRESS',
    assignedTo: 'infrastructure.team@company.com',
    remediation: {
      effort: 'Low',
      timeline: '1 day',
      priority: 'High',
      steps: [
        'Schedule maintenance window',
        'Update Apache to latest version',
        'Test application functionality',
        'Monitor for issues'
      ]
    },
    evidence: {
      version: 'Apache/2.4.41 (Ubuntu)',
      vulnerableFeatures: ['mod_rewrite', 'mod_proxy'],
      patchAvailable: 'Apache 2.4.58'
    },
    riskScore: 75,
    exploitability: 'Medium',
    impact: 'Potential remote code execution',
    tags: ['apache', 'outdated-component', 'rce', 'infrastructure'],
    slaDeadline: new Date('2024-01-17T09:15:00Z'),
    references: [
      'https://httpd.apache.org/security/vulnerabilities_24.html',
      'https://nvd.nist.gov/vuln/detail/CVE-2023-25690'
    ]
  },
  {
    id: 'VULN-2024-003',
    title: 'Cross-Site Scripting in Contact Form',
    description: 'Reflected XSS vulnerability in the contact form allows script injection.',
    category: 'XSS',
    severity: 'MEDIUM',
    cvssScore: 6.1,
    cveId: null,
    discoveredDate: new Date('2024-01-13T16:45:00Z'),
    lastSeen: new Date('2024-01-15T11:30:00Z'),
    affectedAssets: ['www.company.com'],
    affectedComponents: ['Contact Form', 'Frontend Application'],
    scanType: 'WEB_APP',
    scanner: 'Burp Suite',
    status: 'TESTING',
    assignedTo: 'web.development@company.com',
    remediation: {
      effort: 'Low',
      timeline: '4-6 hours',
      priority: 'Medium',
      steps: [
        'Implement output encoding',
        'Add Content Security Policy',
        'Validate and sanitize inputs',
        'Perform XSS testing'
      ]
    },
    evidence: {
      parameter: 'message',
      payload: '<script>alert("XSS")</script>',
      location: '/contact?message=<script>alert("XSS")</script>'
    },
    riskScore: 60,
    exploitability: 'Medium',
    impact: 'Session hijacking, data theft',
    tags: ['xss', 'contact-form', 'web-app', 'owasp-top10'],
    slaDeadline: new Date('2024-01-20T16:45:00Z'),
    references: [
      'https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)',
      'https://cwe.mitre.org/data/definitions/79.html'
    ]
  },
  {
    id: 'VULN-2024-004',
    title: 'Weak SSL/TLS Configuration',
    description: 'SSL/TLS configuration allows weak cipher suites and protocols.',
    category: 'SECURITY_CONFIG',
    severity: 'MEDIUM',
    cvssScore: 5.3,
    cveId: null,
    discoveredDate: new Date('2024-01-12T14:20:00Z'),
    lastSeen: new Date('2024-01-15T10:15:00Z'),
    affectedAssets: ['api.company.com', 'admin.company.com'],
    affectedComponents: ['Load Balancer', 'SSL Termination'],
    scanType: 'NETWORK',
    scanner: 'SSL Labs',
    status: 'RESOLVED',
    assignedTo: 'network.team@company.com',
    remediation: {
      effort: 'Medium',
      timeline: '1-2 days',
      priority: 'Medium',
      steps: [
        'Update SSL/TLS configuration',
        'Disable weak cipher suites',
        'Enable perfect forward secrecy',
        'Test SSL configuration'
      ]
    },
    evidence: {
      weakCiphers: ['TLS_RSA_WITH_3DES_EDE_CBC_SHA', 'TLS_RSA_WITH_RC4_128_SHA'],
      protocols: ['TLSv1.0', 'TLSv1.1'],
      grade: 'B'
    },
    riskScore: 50,
    exploitability: 'Low',
    impact: 'Man-in-the-middle attacks',
    tags: ['ssl', 'tls', 'encryption', 'configuration'],
    slaDeadline: new Date('2024-01-19T14:20:00Z'),
    references: [
      'https://www.ssllabs.com/ssltest/',
      'https://wiki.mozilla.org/Security/Server_Side_TLS'
    ]
  },
  {
    id: 'VULN-2024-005',
    title: 'Missing Security Headers',
    description: 'Web application missing critical security headers for protection against common attacks.',
    category: 'SECURITY_CONFIG',
    severity: 'LOW',
    cvssScore: 3.7,
    cveId: null,
    discoveredDate: new Date('2024-01-11T11:00:00Z'),
    lastSeen: new Date('2024-01-15T09:45:00Z'),
    affectedAssets: ['www.company.com', 'app.company.com'],
    affectedComponents: ['Web Server', 'Application Framework'],
    scanType: 'WEB_APP',
    scanner: 'Security Headers',
    status: 'ACCEPTED',
    assignedTo: 'web.development@company.com',
    remediation: {
      effort: 'Low',
      timeline: '2-4 hours',
      priority: 'Low',
      steps: [
        'Add X-Frame-Options header',
        'Implement Content-Security-Policy',
        'Add X-Content-Type-Options',
        'Configure Strict-Transport-Security'
      ]
    },
    evidence: {
      missingHeaders: [
        'X-Frame-Options',
        'Content-Security-Policy',
        'X-Content-Type-Options',
        'Strict-Transport-Security'
      ],
      currentGrade: 'D'
    },
    riskScore: 30,
    exploitability: 'Low',
    impact: 'Clickjacking, MIME sniffing',
    tags: ['security-headers', 'web-app', 'configuration'],
    slaDeadline: new Date('2024-01-31T11:00:00Z'),
    references: [
      'https://owasp.org/www-project-secure-headers/',
      'https://securityheaders.com/'
    ]
  }
];

// Scan history
const scanHistory = [
  {
    id: 'scan_001',
    name: 'Weekly Infrastructure Scan',
    type: 'INFRASTRUCTURE',
    status: 'completed',
    startTime: new Date('2024-01-15T02:00:00Z'),
    endTime: new Date('2024-01-15T04:30:00Z'),
    duration: '2h 30m',
    assetsScanned: 45,
    vulnerabilitiesFound: 12,
    criticalFindings: 1,
    highFindings: 3,
    mediumFindings: 5,
    lowFindings: 3,
    scanner: 'Nessus Professional',
    coverage: 98.5
  },
  {
    id: 'scan_002',
    name: 'Web Application Security Test',
    type: 'WEB_APP',
    status: 'completed',
    startTime: new Date('2024-01-14T18:00:00Z'),
    endTime: new Date('2024-01-14T22:15:00Z'),
    duration: '4h 15m',
    assetsScanned: 8,
    vulnerabilitiesFound: 7,
    criticalFindings: 1,
    highFindings: 1,
    mediumFindings: 3,
    lowFindings: 2,
    scanner: 'OWASP ZAP',
    coverage: 95.2
  },
  {
    id: 'scan_003',
    name: 'Database Security Assessment',
    type: 'DATABASE',
    status: 'running',
    startTime: new Date('2024-01-15T14:00:00Z'),
    endTime: null,
    duration: null,
    assetsScanned: 3,
    vulnerabilitiesFound: 0,
    criticalFindings: 0,
    highFindings: 0,
    mediumFindings: 0,
    lowFindings: 0,
    scanner: 'DbProtect',
    coverage: 45.0
  }
];

// Vulnerability metrics
const vulnerabilityMetrics = {
  totalVulnerabilities: 156,
  openVulnerabilities: 89,
  criticalVulnerabilities: 5,
  highVulnerabilities: 23,
  mediumVulnerabilities: 45,
  lowVulnerabilities: 16,
  averageResolutionTime: 5.2, // days
  mttr: 3.8, // mean time to resolution
  slaCompliance: 92.3,
  riskScore: 7.2,
  trendsImproving: true
};

// Vulnerability trends
const vulnerabilityTrends = [
  { date: '2024-01-09', total: 165, critical: 8, high: 28, medium: 52, low: 18, resolved: 59 },
  { date: '2024-01-10', total: 162, critical: 7, high: 26, medium: 51, low: 19, resolved: 59 },
  { date: '2024-01-11', total: 159, critical: 6, high: 25, medium: 50, low: 18, resolved: 60 },
  { date: '2024-01-12', total: 158, critical: 6, high: 24, medium: 49, low: 19, resolved: 60 },
  { date: '2024-01-13', total: 157, critical: 5, high: 24, medium: 48, low: 18, resolved: 62 },
  { date: '2024-01-14', total: 156, critical: 5, high: 23, medium: 46, low: 17, resolved: 65 },
  { date: '2024-01-15', total: 156, critical: 5, high: 23, medium: 45, low: 16, resolved: 67 }
];

// Asset inventory
const assetInventory = [
  {
    id: 'asset_001',
    name: 'web-app-01.company.com',
    type: 'Web Application',
    criticality: 'High',
    owner: 'Web Development Team',
    lastScanned: new Date('2024-01-15T04:30:00Z'),
    vulnerabilities: 8,
    riskScore: 85,
    status: 'Active'
  },
  {
    id: 'asset_002',
    name: 'db-server-01.company.com',
    type: 'Database Server',
    criticality: 'Critical',
    owner: 'Database Team',
    lastScanned: new Date('2024-01-15T14:00:00Z'),
    vulnerabilities: 3,
    riskScore: 45,
    status: 'Active'
  },
  {
    id: 'asset_003',
    name: 'api.company.com',
    type: 'API Gateway',
    criticality: 'High',
    owner: 'Platform Team',
    lastScanned: new Date('2024-01-15T04:30:00Z'),
    vulnerabilities: 12,
    riskScore: 72,
    status: 'Active'
  }
];

const VulnerabilityManagement = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [selectedVulnerability, setSelectedVulnerability] = useState(null);
  const [selectedScan, setSelectedScan] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [severityFilter, setSeverityFilter] = useState('all');
  const [statusFilter, setStatusFilter] = useState('all');
  const [categoryFilter, setCategoryFilter] = useState('all');
  const [showNewScan, setShowNewScan] = useState(false);
  const [showVulnDetails, setShowVulnDetails] = useState(false);
  const [isScanning, setIsScanning] = useState(false);

  const getSeverityColor = (severity) => {
    const colors = {
      CRITICAL: 'bg-red-100 text-red-800 border-red-200',
      HIGH: 'bg-orange-100 text-orange-800 border-orange-200',
      MEDIUM: 'bg-yellow-100 text-yellow-800 border-yellow-200',
      LOW: 'bg-green-100 text-green-800 border-green-200',
      INFO: 'bg-blue-100 text-blue-800 border-blue-200'
    };
    return colors[severity] || 'bg-gray-100 text-gray-800 border-gray-200';
  };

  const getStatusColor = (status) => {
    const colors = {
      OPEN: 'bg-red-100 text-red-800 border-red-200',
      IN_PROGRESS: 'bg-yellow-100 text-yellow-800 border-yellow-200',
      TESTING: 'bg-blue-100 text-blue-800 border-blue-200',
      RESOLVED: 'bg-green-100 text-green-800 border-green-200',
      ACCEPTED: 'bg-gray-100 text-gray-800 border-gray-200',
      FALSE_POSITIVE: 'bg-purple-100 text-purple-800 border-purple-200'
    };
    return colors[status] || 'bg-gray-100 text-gray-800 border-gray-200';
  };

  const getCriticalityColor = (criticality) => {
    const colors = {
      Critical: 'bg-red-100 text-red-800',
      High: 'bg-orange-100 text-orange-800',
      Medium: 'bg-yellow-100 text-yellow-800',
      Low: 'bg-green-100 text-green-800'
    };
    return colors[criticality] || 'bg-gray-100 text-gray-800';
  };

  const getTimeRemaining = (deadline) => {
    if (!deadline) return 'No SLA';
    const now = new Date();
    const diff = deadline - now;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const days = Math.floor(hours / 24);
    
    if (days > 0) return `${days}d remaining`;
    if (hours > 0) return `${hours}h remaining`;
    return 'Overdue';
  };

  const VulnerabilityCard = ({ vulnerability }) => {
    const CategoryIcon = VULNERABILITY_CATEGORIES[vulnerability.category]?.icon || Bug;
    const StatusIcon = REMEDIATION_STATUS[vulnerability.status]?.icon || AlertCircle;
    
    return (
      <Card className="hover:shadow-md transition-shadow cursor-pointer" onClick={() => setSelectedVulnerability(vulnerability)}>
        <CardContent className="p-4">
          <div className="flex items-start justify-between mb-3">
            <div className="flex items-start space-x-3">
              <div className={`p-2 rounded-lg bg-${VULNERABILITY_CATEGORIES[vulnerability.category]?.color}-100`}>
                <CategoryIcon className={`h-4 w-4 text-${VULNERABILITY_CATEGORIES[vulnerability.category]?.color}-600`} />
              </div>
              <div>
                <h3 className="font-semibold text-sm">{vulnerability.id}</h3>
                <p className="text-xs text-gray-600 line-clamp-2">{vulnerability.title}</p>
                <p className="text-xs text-gray-500">{vulnerability.discoveredDate.toLocaleDateString()}</p>
              </div>
            </div>
            <div className="text-right">
              <Badge className={getSeverityColor(vulnerability.severity)}>
                {vulnerability.severity}
              </Badge>
              <Badge className={getStatusColor(vulnerability.status)} variant="outline">
                {vulnerability.status}
              </Badge>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-2 text-xs mb-3">
            <div>
              <span className="text-gray-600">CVSS Score:</span>
              <span className="ml-1 font-medium">{vulnerability.cvssScore}</span>
            </div>
            <div>
              <span className="text-gray-600">Category:</span>
              <span className="ml-1 font-medium">{VULNERABILITY_CATEGORIES[vulnerability.category]?.name}</span>
            </div>
            <div>
              <span className="text-gray-600">Assets:</span>
              <span className="ml-1 font-medium">{vulnerability.affectedAssets.length}</span>
            </div>
            <div>
              <span className="text-gray-600">SLA:</span>
              <span className={`ml-1 font-medium ${vulnerability.slaDeadline && new Date() > vulnerability.slaDeadline ? 'text-red-600' : 'text-green-600'}`}>
                {getTimeRemaining(vulnerability.slaDeadline)}
              </span>
            </div>
          </div>

          <div className="space-y-2">
            <div className="flex items-center justify-between text-xs">
              <span className="text-gray-600">Risk Score:</span>
              <StatusIcon className="h-3 w-3" />
            </div>
            
            <div className="flex flex-wrap gap-1">
              {vulnerability.tags.slice(0, 3).map((tag) => (
                <Badge key={tag} variant="outline" className="text-xs">
                  {tag}
                </Badge>
              ))}
              {vulnerability.tags.length > 3 && (
                <Badge variant="outline" className="text-xs">
                  +{vulnerability.tags.length - 3}
                </Badge>
              )}
            </div>
          </div>

          <div className="mt-3">
            <div className="flex items-center justify-between text-xs mb-1">
              <span className="text-gray-600">Risk Level:</span>
              <span className="font-medium">{vulnerability.riskScore}%</span>
            </div>
            <Progress value={vulnerability.riskScore} className="h-2" />
          </div>
        </CardContent>
      </Card>
    );
  };

  const ScanCard = ({ scan }) => {
    const ScanIcon = SCAN_TYPES[scan.type]?.icon || Scan;
    
    return (
      <Card className="hover:shadow-md transition-shadow cursor-pointer" onClick={() => setSelectedScan(scan)}>
        <CardContent className="p-4">
          <div className="flex items-start justify-between mb-3">
            <div className="flex items-start space-x-3">
              <div className="p-2 bg-blue-100 rounded-lg">
                <ScanIcon className="h-4 w-4 text-blue-600" />
              </div>
              <div>
                <h3 className="font-semibold text-sm">{scan.name}</h3>
                <p className="text-xs text-gray-600">{SCAN_TYPES[scan.type]?.name}</p>
                <p className="text-xs text-gray-500">{scan.startTime.toLocaleString()}</p>
              </div>
            </div>
            <Badge className={scan.status === 'completed' ? 'bg-green-100 text-green-800' : scan.status === 'running' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}>
              {scan.status}
            </Badge>
          </div>

          <div className="grid grid-cols-2 gap-2 text-xs mb-3">
            <div>
              <span className="text-gray-600">Assets:</span>
              <span className="ml-1 font-medium">{scan.assetsScanned}</span>
            </div>
            <div>
              <span className="text-gray-600">Duration:</span>
              <span className="ml-1 font-medium">{scan.duration || 'In Progress'}</span>
            </div>
            <div>
              <span className="text-gray-600">Findings:</span>
              <span className="ml-1 font-medium">{scan.vulnerabilitiesFound}</span>
            </div>
            <div>
              <span className="text-gray-600">Coverage:</span>
              <span className="ml-1 font-medium">{scan.coverage}%</span>
            </div>
          </div>

          {scan.status === 'completed' && (
            <div className="space-y-2">
              <div className="flex justify-between text-xs">
                <span className="text-red-600">Critical: {scan.criticalFindings}</span>
                <span className="text-orange-600">High: {scan.highFindings}</span>
              </div>
              <div className="flex justify-between text-xs">
                <span className="text-yellow-600">Medium: {scan.mediumFindings}</span>
                <span className="text-green-600">Low: {scan.lowFindings}</span>
              </div>
            </div>
          )}

          {scan.status === 'running' && (
            <div className="mt-3">
              <div className="flex items-center justify-between text-xs mb-1">
                <span className="text-gray-600">Progress:</span>
                <span className="font-medium">{scan.coverage}%</span>
              </div>
              <Progress value={scan.coverage} className="h-2" />
            </div>
          )}
        </CardContent>
      </Card>
    );
  };

  const AssetCard = ({ asset }) => (
    <Card className="hover:shadow-md transition-shadow">
      <CardContent className="p-4">
        <div className="flex items-start justify-between mb-3">
          <div className="flex items-start space-x-3">
            <div className="p-2 bg-purple-100 rounded-lg">
              <Server className="h-4 w-4 text-purple-600" />
            </div>
            <div>
              <h3 className="font-semibold text-sm">{asset.name}</h3>
              <p className="text-xs text-gray-600">{asset.type}</p>
              <p className="text-xs text-gray-500">Owner: {asset.owner}</p>
            </div>
          </div>
          <Badge className={getCriticalityColor(asset.criticality)}>
            {asset.criticality}
          </Badge>
        </div>

        <div className="space-y-2 text-xs">
          <div className="flex justify-between">
            <span className="text-gray-600">Vulnerabilities:</span>
            <span className="font-medium">{asset.vulnerabilities}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-600">Risk Score:</span>
            <span className="font-medium">{asset.riskScore}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-600">Last Scanned:</span>
            <span className="font-medium">{asset.lastScanned.toLocaleDateString()}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-600">Status:</span>
            <Badge variant="outline" className="text-xs">{asset.status}</Badge>
          </div>
        </div>

        <div className="mt-3">
          <div className="flex items-center justify-between text-xs mb-1">
            <span className="text-gray-600">Risk Level:</span>
            <span className="font-medium">{asset.riskScore}%</span>
          </div>
          <Progress value={asset.riskScore} className="h-2" />
        </div>
      </CardContent>
    </Card>
  );

  return (
    <div className="p-6 space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">Vulnerability Management</h1>
          <p className="text-gray-600 mt-1">
            Automated scanning, risk assessment, and remediation tracking
          </p>
        </div>
        <div className="flex items-center space-x-3">
          <div className="flex items-center space-x-2">
            <Switch checked={isScanning} onCheckedChange={setIsScanning} />
            <span className="text-sm">Auto Scanning</span>
            {isScanning && <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />}
          </div>
          <Button variant="outline" onClick={() => setShowNewScan(true)}>
            <Scan className="h-4 w-4 mr-2" />
            New Scan
          </Button>
          <Button variant="outline">
            <Download className="h-4 w-4 mr-2" />
            Export Report
          </Button>
        </div>
      </div>

      {/* Key Metrics */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-gray-600">Open Vulnerabilities</p>
                <p className="text-2xl font-bold text-red-600">{vulnerabilityMetrics.openVulnerabilities}</p>
              </div>
              <Bug className="h-8 w-8 text-red-600" />
            </div>
            <div className="flex items-center mt-2 text-sm">
              <AlertTriangle className="h-4 w-4 text-gray-600 mr-1" />
              <span className="text-gray-600">{vulnerabilityMetrics.criticalVulnerabilities} critical</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-gray-600">Risk Score</p>
                <p className="text-2xl font-bold text-orange-600">{vulnerabilityMetrics.riskScore}</p>
              </div>
              <Target className="h-8 w-8 text-orange-600" />
            </div>
            <div className="flex items-center mt-2 text-sm">
              {vulnerabilityMetrics.trendsImproving ? (
                <TrendingDown className="h-4 w-4 text-green-600 mr-1" />
              ) : (
                <TrendingUp className="h-4 w-4 text-red-600 mr-1" />
              )}
              <span className={vulnerabilityMetrics.trendsImproving ? 'text-green-600' : 'text-red-600'}>
                {vulnerabilityMetrics.trendsImproving ? 'Improving' : 'Worsening'}
              </span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-gray-600">MTTR</p>
                <p className="text-2xl font-bold text-blue-600">{vulnerabilityMetrics.mttr}d</p>
              </div>
              <Clock className="h-8 w-8 text-blue-600" />
            </div>
            <div className="flex items-center mt-2 text-sm">
              <TrendingDown className="h-4 w-4 text-green-600 mr-1" />
              <span className="text-green-600">12% improvement</span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-gray-600">SLA Compliance</p>
                <p className="text-2xl font-bold text-green-600">{vulnerabilityMetrics.slaCompliance}%</p>
              </div>
              <CheckCircle className="h-8 w-8 text-green-600" />
            </div>
            <Progress value={vulnerabilityMetrics.slaCompliance} className="mt-2 h-2" />
          </CardContent>
        </Card>
      </div>

      {/* Main Tabs */}
      <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
        <TabsList className="grid w-full grid-cols-6">
          <TabsTrigger value="dashboard">Dashboard</TabsTrigger>
          <TabsTrigger value="vulnerabilities">Vulnerabilities</TabsTrigger>
          <TabsTrigger value="scans">Scans</TabsTrigger>
          <TabsTrigger value="assets">Assets</TabsTrigger>
          <TabsTrigger value="remediation">Remediation</TabsTrigger>
          <TabsTrigger value="analytics">Analytics</TabsTrigger>
        </TabsList>

        {/* Dashboard Tab */}
        <TabsContent value="dashboard" className="space-y-6">
          {/* Vulnerability Trends */}
          <Card>
            <CardHeader>
              <CardTitle>Vulnerability Trends</CardTitle>
              <CardDescription>Daily vulnerability count by severity level</CardDescription>
            </CardHeader>
            <CardContent>
              <ResponsiveContainer width="100%" height={300}>
                <AreaChart data={vulnerabilityTrends}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="date" />
                  <YAxis />
                  <Tooltip />
                  <Legend />
                  <Area type="monotone" dataKey="critical" stackId="1" stroke="#ef4444" fill="#fee2e2" />
                  <Area type="monotone" dataKey="high" stackId="1" stroke="#f97316" fill="#fed7aa" />
                  <Area type="monotone" dataKey="medium" stackId="1" stroke="#eab308" fill="#fef3c7" />
                  <Area type="monotone" dataKey="low" stackId="1" stroke="#22c55e" fill="#dcfce7" />
                </AreaChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>

          {/* Recent Activity */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <Card>
              <CardHeader>
                <CardTitle>Critical Vulnerabilities</CardTitle>
                <CardDescription>High priority vulnerabilities requiring immediate attention</CardDescription>
              </CardHeader>
              <CardContent>
                <ScrollArea className="h-64">
                  <div className="space-y-3">
                    {vulnerabilities
                      .filter(vuln => vuln.severity === 'CRITICAL' || vuln.severity === 'HIGH')
                      .slice(0, 3)
                      .map((vulnerability) => (
                        <VulnerabilityCard key={vulnerability.id} vulnerability={vulnerability} />
                      ))}
                  </div>
                </ScrollArea>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle>Recent Scans</CardTitle>
                <CardDescription>Latest vulnerability scans and results</CardDescription>
              </CardHeader>
              <CardContent>
                <ScrollArea className="h-64">
                  <div className="space-y-3">
                    {scanHistory.slice(0, 3).map((scan) => (
                      <ScanCard key={scan.id} scan={scan} />
                    ))}
                  </div>
                </ScrollArea>
              </CardContent>
            </Card>
          </div>
        </TabsContent>

        {/* Vulnerabilities Tab */}
        <TabsContent value="vulnerabilities" className="space-y-6">
          {/* Vulnerability Filters */}
          <Card>
            <CardContent className="p-4">
              <div className="flex items-center space-x-4">
                <div className="flex-1">
                  <Input
                    placeholder="Search vulnerabilities..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="max-w-sm"
                  />
                </div>
                <Select value={severityFilter} onValueChange={setSeverityFilter}>
                  <SelectTrigger className="w-40">
                    <SelectValue placeholder="Severity" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">All Severity</SelectItem>
                    {Object.entries(SEVERITY_LEVELS).map(([key, severity]) => (
                      <SelectItem key={key} value={key}>{severity.name}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
                <Select value={statusFilter} onValueChange={setStatusFilter}>
                  <SelectTrigger className="w-40">
                    <SelectValue placeholder="Status" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">All Status</SelectItem>
                    {Object.entries(REMEDIATION_STATUS).map(([key, status]) => (
                      <SelectItem key={key} value={key}>{status.name}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
                <Select value={categoryFilter} onValueChange={setCategoryFilter}>
                  <SelectTrigger className="w-40">
                    <SelectValue placeholder="Category" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">All Categories</SelectItem>
                    {Object.entries(VULNERABILITY_CATEGORIES).map(([key, category]) => (
                      <SelectItem key={key} value={key}>{category.name}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            </CardContent>
          </Card>

          {/* Vulnerabilities Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {vulnerabilities
              .filter(vuln => 
                (severityFilter === 'all' || vuln.severity === severityFilter) &&
                (statusFilter === 'all' || vuln.status === statusFilter) &&
                (categoryFilter === 'all' || vuln.category === categoryFilter) &&
                (searchTerm === '' || 
                  vuln.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                  vuln.id.toLowerCase().includes(searchTerm.toLowerCase())
                )
              )
              .map((vulnerability) => (
                <VulnerabilityCard key={vulnerability.id} vulnerability={vulnerability} />
              ))}
          </div>
        </TabsContent>

        {/* Scans Tab */}
        <TabsContent value="scans" className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {scanHistory.map((scan) => (
              <ScanCard key={scan.id} scan={scan} />
            ))}
          </div>
        </TabsContent>

        {/* Assets Tab */}
        <TabsContent value="assets" className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {assetInventory.map((asset) => (
              <AssetCard key={asset.id} asset={asset} />
            ))}
          </div>
        </TabsContent>

        {/* Remediation Tab */}
        <TabsContent value="remediation" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle>Remediation Tracking</CardTitle>
              <CardDescription>Track vulnerability remediation progress and timelines</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {vulnerabilities
                  .filter(vuln => vuln.status !== 'RESOLVED' && vuln.status !== 'FALSE_POSITIVE')
                  .map((vulnerability) => (
                    <div key={vulnerability.id} className="p-4 border rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <h3 className="font-semibold">{vulnerability.title}</h3>
                        <Badge className={getSeverityColor(vulnerability.severity)}>
                          {vulnerability.severity}
                        </Badge>
                      </div>
                      <div className="grid grid-cols-2 gap-4 text-sm">
                        <div>
                          <span className="text-gray-600">Assigned to:</span>
                          <span className="ml-2">{vulnerability.assignedTo}</span>
                        </div>
                        <div>
                          <span className="text-gray-600">Effort:</span>
                          <span className="ml-2">{vulnerability.remediation.effort}</span>
                        </div>
                        <div>
                          <span className="text-gray-600">Timeline:</span>
                          <span className="ml-2">{vulnerability.remediation.timeline}</span>
                        </div>
                        <div>
                          <span className="text-gray-600">SLA:</span>
                          <span className="ml-2">{getTimeRemaining(vulnerability.slaDeadline)}</span>
                        </div>
                      </div>
                      <div className="mt-3">
                        <span className="text-sm text-gray-600">Remediation Steps:</span>
                        <ul className="mt-1 text-sm list-disc list-inside">
                          {vulnerability.remediation.steps.map((step, index) => (
                            <li key={index} className="text-gray-700">{step}</li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        {/* Analytics Tab */}
        <TabsContent value="analytics" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle>Vulnerability Analytics</CardTitle>
              <CardDescription>Comprehensive vulnerability metrics and performance indicators</CardDescription>
            </CardHeader>
            <CardContent>
              <ResponsiveContainer width="100%" height={400}>
                <BarChart data={vulnerabilityTrends}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="date" />
                  <YAxis />
                  <Tooltip />
                  <Legend />
                  <Bar dataKey="total" fill="#3b82f6" />
                  <Bar dataKey="resolved" fill="#22c55e" />
                  <Bar dataKey="critical" fill="#ef4444" />
                </BarChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>

      {/* Vulnerability Details Dialog */}
      <Dialog open={!!selectedVulnerability} onOpenChange={() => setSelectedVulnerability(null)}>
        <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>Vulnerability Details - {selectedVulnerability?.id}</DialogTitle>
            <DialogDescription>
              Comprehensive vulnerability information and remediation guidance
            </DialogDescription>
          </DialogHeader>
          {selectedVulnerability && (
            <div className="space-y-6">
              {/* Basic Information */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <Label className="text-sm font-medium text-gray-600">Title</Label>
                  <p className="text-sm">{selectedVulnerability.title}</p>
                </div>
                <div>
                  <Label className="text-sm font-medium text-gray-600">CVE ID</Label>
                  <p className="text-sm">{selectedVulnerability.cveId || 'N/A'}</p>
                </div>
                <div>
                  <Label className="text-sm font-medium text-gray-600">Severity</Label>
                  <Badge className={getSeverityColor(selectedVulnerability.severity)}>
                    {selectedVulnerability.severity}
                  </Badge>
                </div>
                <div>
                  <Label className="text-sm font-medium text-gray-600">CVSS Score</Label>
                  <p className="text-sm font-bold">{selectedVulnerability.cvssScore}</p>
                </div>
                <div>
                  <Label className="text-sm font-medium text-gray-600">Category</Label>
                  <p className="text-sm">{VULNERABILITY_CATEGORIES[selectedVulnerability.category]?.name}</p>
                </div>
                <div>
                  <Label className="text-sm font-medium text-gray-600">Status</Label>
                  <Badge className={getStatusColor(selectedVulnerability.status)}>
                    {selectedVulnerability.status}
                  </Badge>
                </div>
                <div>
                  <Label className="text-sm font-medium text-gray-600">Discovered</Label>
                  <p className="text-sm">{selectedVulnerability.discoveredDate.toLocaleString()}</p>
                </div>
                <div>
                  <Label className="text-sm font-medium text-gray-600">Risk Score</Label>
                  <p className="text-sm font-bold">{selectedVulnerability.riskScore}</p>
                </div>
              </div>

              <Separator />

              {/* Description */}
              <div>
                <Label className="text-sm font-medium text-gray-600">Description</Label>
                <p className="text-sm bg-gray-50 p-3 rounded mt-1">{selectedVulnerability.description}</p>
              </div>

              {/* Affected Assets */}
              <div>
                <Label className="text-sm font-medium text-gray-600">Affected Assets</Label>
                <div className="flex flex-wrap gap-1 mt-2">
                  {selectedVulnerability.affectedAssets.map((asset) => (
                    <Badge key={asset} variant="outline" className="text-xs">
                      {asset}
                    </Badge>
                  ))}
                </div>
              </div>

              {/* Evidence */}
              <div>
                <Label className="text-sm font-medium text-gray-600">Evidence</Label>
                <div className="mt-2 p-3 bg-gray-50 rounded text-sm">
                  <pre className="whitespace-pre-wrap">{JSON.stringify(selectedVulnerability.evidence, null, 2)}</pre>
                </div>
              </div>

              {/* Remediation */}
              <div>
                <Label className="text-sm font-medium text-gray-600">Remediation Steps</Label>
                <div className="mt-2 space-y-2">
                  {selectedVulnerability.remediation.steps.map((step, index) => (
                    <div key={index} className="flex items-start space-x-2">
                      <div className="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium">
                        {index + 1}
                      </div>
                      <p className="text-sm">{step}</p>
                    </div>
                  ))}
                </div>
              </div>

              {/* References */}
              <div>
                <Label className="text-sm font-medium text-gray-600">References</Label>
                <div className="flex flex-wrap gap-2 mt-2">
                  {selectedVulnerability.references.map((ref, index) => (
                    <a
                      key={index}
                      href={ref}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-blue-600 hover:text-blue-800 text-xs underline"
                    >
                      {ref}
                    </a>
                  ))}
                </div>
              </div>

              {/* Tags */}
              <div>
                <Label className="text-sm font-medium text-gray-600">Tags</Label>
                <div className="flex flex-wrap gap-1 mt-2">
                  {selectedVulnerability.tags.map((tag) => (
                    <Badge key={tag} variant="outline" className="text-xs">
                      {tag}
                    </Badge>
                  ))}
                </div>
              </div>
            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
};

export default VulnerabilityManagement;